<!DOCTYPE html>
<html>
  <head>
    <title>Калькулятор растяжек</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/tables.css">
    <link rel="stylesheet" href="css/line_styles.css">
    <script src="js/tables.js"></script>
    <script src="js/glaze_calculator.js"></script>
    <style>
      .section_title {
        font-size: 24px;
        color: #333;
        margin: 0 0 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #ed1c24;
        text-align: center;
        font-weight: 600;
      }
      
      .mixer_container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }
      
      .mixer_section {
        margin-bottom: 50px;
      }
      
      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-bottom: 20px;
      }
      
      .control_item {
        display: flex;
        flex-direction: column;
        min-width: 200px;
        flex: 1;
      }
      
      .control_label {
        margin-bottom: 5px;
        font-weight: 500;
      }
      
      .control_input {
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
        width: 100%;
      }
      
      @media (max-width: 768px) {
        .control_item {
          min-width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="mixer_container">
      <!-- +++L I N E-->
      <div class="table_container">
        <h2 class="section_title">Линейная растяжка</h2>
        <div class="controls">
          <div class="control_item">
            <label class="control_label">Длина растяжки:</label>
            <input type="number" min="3" max="11" value="3" class="line_size control_input">
          </div>
          <div class="control_item">
            <label class="control_label">Обьем глазури на один тестер:</label>
            <input type="number" min="1" max="100" value="5" class="line_tester_volume control_input">
          </div>
          <div class="control_item">
            <label class="control_label">Итоговая плотность глазури:</label>
            <input type="number" min="1" max="2" value="1.5" step="0.05" class="density control_input">
          </div>
          <div class="control_item">
            <label class="control_label">Истинная плотность сухой смеси:</label>
            <input type="number" min="1.1" max="5" value="2.5" step="0.1" class="dry_density control_input">
          </div>
        </div>
        <div class="calc calc__1"></div>
        <div class="summary_container"></div>
      </div>
      
      <!-- Здесь можно добавить другие секции -->
      
    </div>
    
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Event handlers
        document.querySelectorAll('input[type="number"]').forEach(input => {
          input.addEventListener('change', () => {
            const container = input.closest('.table_container');
            const table = container.querySelector('.calc__1');
            const line_size = parseInt(container.querySelector('.line_size').value);
            const tester_volume = parseInt(container.querySelector('.line_tester_volume').value);
            
            // Clear old table
            table.innerHTML = '';
            
            const line_data = generate_line_data(line_size, tester_volume);
            generate_line_table(line_size, line_data, table);
          });
        });

        
        // Функция для генерации пропорций в зависимости от размера линии
        

        // Функция для обновления блока с итоговыми суммами
        function update_summary(data, size) {
          const summary_container = document.querySelector('.summary_container');
          let total_first_volume = 0;
          let total_second_volume = 0;
          
          // Рассчитываем суммы объемов для каждого состава
          for (let i = 1; i <= size; i++) {
            if (data[i].content[1][1]) {
              total_first_volume += data[i].content[1][1];
            }
            if (data[i].content[2][1]) {
              total_second_volume += data[i].content[2][1];
            }
          }
          
          // Округляем до 0.5
          total_first_volume = Math.round(total_first_volume * 2) / 2;
          total_second_volume = Math.round(total_second_volume * 2) / 2;
          
          // Общий объем всех тестеров
          const total_volume = total_first_volume + total_second_volume;
          
          // Получаем значение плотности и истинной плотности сухой смеси
          const density = parseFloat(document.querySelector('.density').value);
          const dry_density = parseFloat(document.querySelector('.dry_density').value);
          
          // Рассчитываем компоненты для первого состава
          const first_components = calculate_powder_and_water(total_first_volume, density, dry_density);
          
          // Рассчитываем компоненты для второго состава
          const second_components = calculate_powder_and_water(total_second_volume, density, dry_density);
          
          // Рассчитываем компоненты для общей базы
          const total_components = calculate_powder_and_water(total_volume, density, dry_density);
          
          // Создаем HTML для блока с суммами
          const summary_html = `
            <div class="summary">
              <p>${total_first_volume}мл состава А (${first_components.powder_mass}г сухой массы + ${first_components.water_mass}г воды) (влажность ${first_components.moisture}%)</p>
              <p>${total_second_volume}мл состава B (${second_components.powder_mass}г сухой массы + ${second_components.water_mass}г воды) (влажность ${second_components.moisture}%)</p>
              <p>Если база общая: ${total_volume}мл общей базы (${total_components.powder_mass}г сухой массы + ${total_components.water_mass}г воды)</p>
            </div>
          `;
          
          summary_container.innerHTML = summary_html;
        }

        // Initial render with generated data
        const initial_size = parseInt(document.querySelector('.line_size').value);
        const initial_volume = parseInt(document.querySelector('.line_tester_volume').value);
        const line_data = generate_line_data(initial_size, initial_volume);
        generate_line_table(initial_size, line_data, document.querySelector('.calc__1'));
        
        // Добавляем обработчик для полей плотности и истинной плотности
        document.querySelectorAll('.density, .dry_density').forEach(input => {
          input.addEventListener('change', () => {
            const container = document.querySelector('.table_container');
            const line_size = parseInt(container.querySelector('.line_size').value);
            const tester_volume = parseInt(container.querySelector('.line_tester_volume').value);
            
            // Обновляем только итоговую сумму, перерендеринг таблицы не требуется
            update_summary(generate_line_data(line_size, tester_volume), line_size);
          });
        });
      });
    </script>
  </body>
</html>


