<!DOCTYPE html>
<html>
  <head>
    <title>Калькулятор смешания цветов</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/tables.css">
    <link rel="stylesheet" href="css/line_styles.css">
    <script src="js/tables.js"></script>

  </head>
  <body>
    <!-- +++L I N E-->
    <div class="table_container">
      <div class="controls">
        <label>Длина растяжки: 
          <input type="number" min="3" max="11" value="3" class="line_size">
        </label>
        <label>Обьем глазури на один тестер: 
          <input type="number" min="1" max="100" value="5" class="line_tester_volume">
        </label>
        <label>Плотность глазури: 
          <input type="number" min="1.2" max="1.8" value="1.4" step="0.01" class="density">
        </label>
      </div>
      <div class="calc calc__1"></div>
      <div class="summary_container"></div>
    </div>
    
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Event handlers
        document.querySelectorAll('input[type="number"]').forEach(input => {
          input.addEventListener('change', () => {
            const container = input.closest('.table_container');
            const table = container.querySelector('.calc__1');
            const line_size = parseInt(container.querySelector('.line_size').value);
            const tester_volume = parseInt(container.querySelector('.line_tester_volume').value);
            
            // Clear old table
            table.innerHTML = '';
            
            const line_data = generate_line_data(line_size, tester_volume);
            generate_line_table(line_size, line_data, table);
          });
        });

        // Data generation functions
        function generate_line_data(size, tester_volume) {
          const data = {};
          // Начальный и конечный цвета линии
          const start_color = '#FFF200';
          const end_color = '#ED1C24';
          
          // Создаем таблицу пропорций в зависимости от размера
          const ratios = generate_ratios(size);
          
          for (let i = 1; i <= size; i++) {
            const first_ratio = ratios[i-1][0];  // Процент первого цвета
            const second_ratio = ratios[i-1][1]; // Процент второго цвета
            
            // Объем компонентов в зависимости от процентов
            const first_volume = first_ratio > 0 ? Math.round(tester_volume * first_ratio / 100 * 2) / 2 : null;
            const second_volume = second_ratio > 0 ? Math.round(tester_volume * second_ratio / 100 * 2) / 2 : null;
            
            // Цвет зависит от соотношения компонентов
            // Если один из компонентов 0%, используем цвет другого компонента
            // Иначе линейно смешиваем цвета
            const first_color = first_ratio > 0 ? start_color : null;
            const second_color = second_ratio > 0 ? end_color : null;
            
            data[i] = {
              name: i.toString(),
              content: {
                1: [first_ratio > 0 ? first_ratio : null, first_volume, first_color],
                2: [second_ratio > 0 ? second_ratio : null, second_volume, second_color]
              }
            };
          }
          
          // Рассчитываем итоговые суммы
          update_summary(data, size);
          
          return data;
        }
        
        // Функция для генерации пропорций в зависимости от размера линии
        function generate_ratios(size) {
          // Таблица процентов для разных размеров линии
          const ratio_tables = {
            3: [[100, 0], [50, 50], [0, 100]],
            4: [[100, 0], [67, 33], [33, 67], [0, 100]],
            5: [[100, 0], [75, 25], [50, 50], [25, 75], [0, 100]],
            6: [[100, 0], [80, 20], [60, 40], [40, 60], [20, 80], [0, 100]],
            7: [[100, 0], [83, 17], [67, 33], [50, 50], [33, 67], [17, 83], [0, 100]],
            8: [[100, 0], [86, 14], [71, 29], [57, 43], [43, 57], [29, 71], [14, 86], [0, 100]],
            9: [[100, 0], [87.5, 12.5], [75, 25], [62.5, 37.5], [50, 50], [37.5, 62.5], [25, 75], [12.5, 87.5], [0, 100]],
            10: [[100, 0], [89, 11], [78, 22], [67, 33], [56, 44], [44, 56], [33, 67], [22, 78], [11, 89], [0, 100]],
            11: [[100, 0], [90, 10], [80, 20], [70, 30], [60, 40], [50, 50], [40, 60], [30, 70], [20, 80], [10, 90], [0, 100]]
          };
          
          // Возвращаем таблицу пропорций для заданного размера
          return ratio_tables[size] || ratio_tables[3]; // Если размер не найден, используем размер 3
        }

        // Функция для обновления блока с итоговыми суммами
        function update_summary(data, size) {
          const summary_container = document.querySelector('.summary_container');
          let total_first_volume = 0;
          let total_second_volume = 0;
          
          // Рассчитываем суммы объемов для каждого состава
          for (let i = 1; i <= size; i++) {
            if (data[i].content[1][1]) {
              total_first_volume += data[i].content[1][1];
            }
            if (data[i].content[2][1]) {
              total_second_volume += data[i].content[2][1];
            }
          }
          
          // Округляем до 0.5
          total_first_volume = Math.round(total_first_volume * 2) / 2;
          total_second_volume = Math.round(total_second_volume * 2) / 2;
          
          // Общий объем всех тестеров
          const total_volume = total_first_volume + total_second_volume;
          
          // Получаем значение плотности
          const density = parseFloat(document.querySelector('.density').value);
          
          // Рассчитываем сухую массу
          const first_dry_mass = Math.round(total_first_volume * density * 10) / 10;
          const second_dry_mass = Math.round(total_second_volume * density * 10) / 10;
          const total_dry_mass = Math.round(total_volume * density * 10) / 10;
          
          // Создаем HTML для блока с суммами
          const summary_html = `
            <div class="summary">
              <h3>Всего надо смешать: ${total_volume}мл</h3>
              <p>${total_first_volume}мл состава А (${first_dry_mass}г сухой массы при плотности ${density})</p>
              <p>${total_second_volume}мл состава B (${second_dry_mass}г сухой массы при плотности ${density})</p>
              <p>Если база общая: ${total_volume}мл общей базы (${total_dry_mass}г сухой массы при плотности ${density})</p>
            </div>
          `;
          
          summary_container.innerHTML = summary_html;
        }

        // Initial render with generated data
        const initial_size = parseInt(document.querySelector('.line_size').value);
        const initial_volume = parseInt(document.querySelector('.line_tester_volume').value);
        const line_data = generate_line_data(initial_size, initial_volume);
        generate_line_table(initial_size, line_data, document.querySelector('.calc__1'));
        
        // Добавляем обработчик для поля плотности
        document.querySelector('.density').addEventListener('change', () => {
          const container = document.querySelector('.table_container');
          const table = container.querySelector('.calc__1');
          const line_size = parseInt(container.querySelector('.line_size').value);
          const tester_volume = parseInt(container.querySelector('.line_tester_volume').value);
          
          // Обновляем только итоговую сумму, перерендеринг таблицы не требуется
          update_summary(generate_line_data(line_size, tester_volume), line_size);
        });
      });
    </script>
  </body>
</html>


